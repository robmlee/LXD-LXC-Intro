# 在 RPi 5 上使用 LXD/LXC 建置 Ollama + Open WebUI

## 一、建立 Ollama 專用 Container
- **1. 建立 Container**
  ```bash=
  ##
  lxc copy ub2204 ollama
  ```
  
- **2. 啟動 Container**
  ```bash=
  ##
  lxc start ollama
  ```

- **3. 登入 Container**
  ```bash=
  ##
  lxc exec ollama -- sudo --login --user ubuntu
  ```
    
## 二、安裝 Ollama
### 1. 安裝 Ollama 
- **1-1. 下載並安裝 Ollama**
  ```bash=
  curl -fsSL https://ollama.com/install.sh | sh
  ```

- **1-2. 查看 Ollama 版本**
  ```bash=
  ##
  ollama --version
  ```
  
- **1-3. 直接由 Ollama 網站下載 TinyLlama 模型，並執行**
  ```bash=
  ollama run tinyllama
  ```
   
  **Prompt: "What is the use case of div tag in html?"，看看回應速度如何？**
  
- **1-4. prompt 指令查詢：**
  ```text=
  >>> /?
  Available Commands:
    /set            Set session variables
    /show           Show model information
    /load <model>   Load a session or model
    /save <model>   Save your current session
    /clear          Clear session context
    /bye            Exit
    /?, /help       Help for a command
    /? shortcuts    Help for keyboard shortcuts
  
  Use """ to begin a multi-line message.
  >>> /bye    <-- 離開 prompt 
  ```

- **1-5. 查詢 Ollama 官網提供哪些模型: [Models on Ollama](https://ollama.com/search)**

- **1-6. 下載 Deepseek-R1 1.15B 模型，並執行**
  ```bash=
  ollama run deepseek-r1:1.5b
  ```

- **1-7. 查看電腦裝了哪些 Models：**
  ```bash=
  ollama list
  ```

- **1-8. 下載或更新 Models：**
  ```bash=
  ollama pull [model]
  ```

- **1-9. 下載後的 Model 存放位置：**
  ```text=
  /usr/share/ollama/.ollama/models
  ```

----
### 2. 升級 Ollama 
- **2-1. 升級 Ollama 的指令，其實與安裝指令一樣，就是再執行一次安裝指令即可：**
  ```bash=
  ##
  curl -fsSL https://ollama.com/install.sh | sh
  
  ##
  sudo systemctl daemon-reload
  sudo systemctl restart ollama
  ```

---
## 四、安裝與更新 OpenWebUI

### 1. 安裝 OpenWebUI
**將以 pipx 來安裝 OpenWebUI**

- **1-1. 安裝 pipx**
  **根據這一篇，Ubuntu 24.04 要安裝 pipx 1.6 以上的版本，需要依照以下的方式來進行：**

```bash=
## installs pipx version 1.4.3 to /usr/local/bin  recall --global is busted
sudo apt install pipx

## adds ~/.local/bin to path
pipx ensurepath

source ~/.bashrc

## installs latest pipx to ~/.local/bin
pipx install pipx

## check version
pipx --version     ## 1.4.3

## remove pipx 1.4.3 via apt,  and all extra files including autocomplete from /usr/local/bin
sudo apt purge --autoremove pipx
```

**這時需要登出再登入！！！**
```bash=
## check version
pipx --version    ## 1.7.x at ~/.local/bin

##installs latest pipx version to /usr/local/bin because --global works.
sudo ~/.local/bin/pipx install pipx --global

## remove the local version
pipx uninstall pipx

#source ~/.bashrc

## check version 
pipx --version    ## 1.7.x at /usr/local/bin
which pipx        ## 1.7.x at /usr/local/bin
```

**這時再一次登出再登入！！！**
```bash=
## make sure the ~/.local/bin is added to $PATH
#pipx ensurepath

## make sure that /usr/local/bin is set to global install
#sudo pipx ensurepath --global

## 
which pipx    ## /usr/local/bin/pipx

#pipx completions
sudo apt install python3-argcomplete
eval "$(register-python-argcomplete pipx)"
```

- **1-2. 安裝 OpenWebUI**
  **安裝可能需要一點時間。**
  ```bash=
  pipx install open-webui
  ```


(todo)
